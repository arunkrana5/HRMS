@model Helpdesk.Ticket.Add
@{
    var TicketPriority = new List<SelectListItem>()
{
             new SelectListItem() {Text="Low", Value="Low"},
             new SelectListItem() {Text="Medium", Value="Medium"},
             new SelectListItem() {Text="High", Value="High"},
        };
}
@section style{

    @Html.IncludeVersionedCss(Url.Content("/assets/design/plugins/fileupload/css/fileupload.css"))

}
<div class="page-header">
    <div class="page-leftheader">
        <h4 class="page-title">Create Ticket </h4>
    </div>

</div>
<div class="card">
    <div class="card-body">

        @using (Ajax.BeginForm("CreateTicket", "HelpDesk",
                new { src = ViewBag.src },
                 new AjaxOptions { HttpMethod = "POST", OnSuccess = "OnSuccess", OnBegin = "ShowLoadingDialog()" },
                    new { @id = "CreateTicketForm", @enctype = "multipart/form-data" })
            )
        {
            @Html.HiddenFor(x => Model.TicketID)
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 form-group">
                    <label>Subject <sup>*</sup></label>
                    @Html.TextAreaFor(model => model.Subject, new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.Subject, "", new { @class = "text-danger" })
                </div>

                <div class="col-lg-3 col-md-3 col-sm-3 form-group">
                    <label>Priority<sup>*</sup></label>
                    @Html.DropDownListFor(n => n.TicketPriority, TicketPriority, "Select Priority",
                        new { @class = "form-control applyselect" })
                    @Html.ValidationMessageFor(model => model.TicketPriority, "", new { @class = "text-danger" })
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 form-group">
                    <label>Category<sup>*</sup></label>
                    @Html.DropDownListFor(n => n.CategoryID, new SelectList(Model.CategoryList, "ID", "Name", Model.CategoryID), "Select Category",
                        new { @class = "form-control applyselect", @Onchange = "FillSubCategory()" })
                    @Html.ValidationMessageFor(model => model.CategoryID, "", new { @class = "text-danger" })
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6 form-group">
                    <label>Sub Category<sup>*</sup></label>
                    @Html.DropDownListFor(n => n.SubCategoryID, new SelectList(Model.SubCategoryList, "ID", "Name", Model.SubCategoryID), "Select Sub Category",
                        new { @class = "form-control applyselect" })
                    @Html.ValidationMessageFor(model => model.SubCategoryID, "", new { @class = "text-danger" })
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 form-group">
                    <label>Optinal Users</label>
                    @Html.DropDownListFor(n => n.OptionalUsers, new SelectList(Model.UserList, "ID", "Name", Model.OptionalUsers),
                        new { @class = "form-control applyselect", @multiple = "multiple" })
                    @Html.ValidationMessageFor(model => model.OptionalUsers, "", new { @class = "text-danger" })
                </div>

                <div class="col-lg-12 col-md-12 col-sm-12 form-group">
                    <label>Message <sup>*</sup></label>
                    @Html.TextAreaFor(model => model.Message, new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.Message, "", new { @class = "text-danger" })
                </div>

                <div class="col-lg-12 col-md-12 col-sm-12 form-group">
                    <label>Attachments</label>
                    @Html.TextBoxFor(x => x.Upload, new { @class = "dropify", @type = "file", @multiple= "multiple" })
                    @Html.ValidationMessageFor(model => model.Upload, "", new { @class = "text-danger" })
                </div>

                <div class="col-lg-12 form-group">

                    <button type="submit" class="btn btn-indigo" name="Command" value="Add"><i class="fa fa-paper-plane" aria-hidden="true"></i> Submit</button>
                    <a href="@Url.Action("MyTicketsList",new { src = ClsCommon.Encrypt(ViewBag.MenuID+"*"+"/HelpDesk/MyTicketsList") })" type="button" class="btn btn-sm  close-btn">Back To List</a>

                </div>

            </div>
        }

    </div>
</div>
@section scripts    {

    @System.Web.Optimization.Scripts.Render("~/bundle/unobtrusivejs")

    @Html.IncludeVersionedJs(Url.Content("~/ckeditor/ckeditor.js"))
    @Html.IncludeVersionedJs(Url.Content("/assets/design/plugins/fileupload/js/dropify.js"))
    @Html.IncludeVersionedJs(Url.Content("/assets/design/js/filupload.js"))
    <script>
        CKEDITOR.replace("Message");

        function OnSuccess(obj) {
            if (obj.Status) {
                SuccessToaster(obj.SuccessMessage);
                window.location.href = obj.RedirectURL;
            }
            else {
                CloseLoadingDialog();
                FailToaster(obj.SuccessMessage);

            }
        }

        function FillSubCategory() {
            var ID = $("#CategoryID").find("option:selected").val();
            if (ID != '') {
                var data = GetDropDownList(ID, "Helpdesk_SubCategoryList");
                if (data != '') {
                    $("#SubCategoryID").empty();
                    $("#SubCategoryID").append($("<option />").val("").text("Select"));
                    $(data).each(function () {
                        $("#SubCategoryID").append($("<option />").val(this.ID).text(this.Name));
                        $("#SubCategoryID").select2();

                    });
                    CloseLoadingDialog();
                } else {
                    $("#SubCategoryID").empty();
                    $("#SubCategoryID").append($("<option />").val("").text("Select"));
                }
            } else {
                $("#SubCategoryID").empty();
                $("#SubCategoryID").append($("<option />").val("").text("Select"));
            }
        }
    </script>
}
